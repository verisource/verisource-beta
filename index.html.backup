<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VeriSource Beta</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{background:white;border-radius:20px;padding:40px;max-width:750px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
.login-screen{text-align:center}
.login-screen h1{color:#667eea;margin-bottom:20px}
.login-screen p{color:#666;margin-bottom:30px}
.login-form input{width:100%;padding:15px;border:2px solid #e0e0e0;border-radius:10px;font-size:1em;margin-bottom:15px}
.login-form input:focus{outline:none;border-color:#667eea}
.login-form button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:15px 40px;border-radius:10px;font-size:1em;cursor:pointer;width:100%;font-weight:600}
.error{color:#e74c3c;margin-top:10px;display:none}
.error.show{display:block}
.test-interface{display:none}
.test-interface.show{display:block}
h1{color:#667eea;margin-bottom:10px;font-size:2em}
.subtitle{color:#666;margin-bottom:20px}
.tabs{display:flex;gap:10px;margin-bottom:30px;border-bottom:2px solid #e0e0e0}
.tab{padding:12px 24px;cursor:pointer;border:none;background:none;color:#666;font-size:1em;transition:all 0.3s;border-bottom:3px solid transparent}
.tab.active{color:#667eea;border-bottom-color:#667eea;font-weight:600}
.tab-content{display:none}
.tab-content.active{display:block}
.upload-area{border:3px dashed #667eea;border-radius:10px;padding:40px;text-align:center;margin-bottom:20px;cursor:pointer;transition:all 0.3s}
.upload-area:hover{background:#f8f9ff;border-color:#764ba2}
.upload-area.dragover{background:#f0f4ff;border-color:#667eea}
.upload-area.small{padding:20px;margin-bottom:10px}
input[type="file"]{display:none}
button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:15px 40px;border-radius:10px;font-size:1em;cursor:pointer;width:100%;font-weight:600;transition:all 0.3s}
button:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,0.4)}
button:disabled{opacity:0.5;cursor:not-allowed}
.result{margin-top:30px;padding:20px;border-radius:10px;background:#f8f9ff;display:none;position:relative}
.result.show{display:block}
.result pre{background:white;padding:15px;border-radius:5px;overflow-x:auto;max-height:400px;overflow-y:auto;font-size:0.85em;white-space:pre-wrap;word-wrap:break-word}
.copy-btn{position:absolute;top:20px;right:20px;padding:8px 16px;font-size:0.85em;width:auto}
.loading{display:none;text-align:center;margin:20px 0}
.loading.show{display:block}
.spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.progress-bar{width:100%;height:8px;background:#e0e0e0;border-radius:4px;margin:15px 0;display:none;overflow:hidden}
.progress-bar.show{display:block}
.progress-fill{height:100%;background:linear-gradient(90deg,#667eea 0%,#764ba2 100%);transition:width 0.3s;width:0}
.info{background:#e8f4f8;border-left:4px solid #667eea;padding:15px;margin-top:20px;border-radius:5px;font-size:0.9em}
.selected-file{margin-top:15px;padding:12px;background:#e8f4f8;border-radius:5px;display:none}
.selected-file.show{display:block}
.logout-btn{background:#e74c3c;padding:10px 20px;font-size:0.9em;margin-top:20px}
.beta-info{margin-top:30px;padding:15px;background:#f8f9ff;border-radius:10px;font-size:0.9em}
.format-badges{display:flex;gap:10px;justify-content:center;margin-top:15px;flex-wrap:wrap}
.format-badge{background:#667eea;color:white;padding:8px 16px;border-radius:20px;font-size:0.85em;display:flex;align-items:center;gap:6px}
.compare-section{margin-top:20px}
.file-slot{border:2px dashed #ccc;border-radius:10px;padding:30px 20px;text-align:center;margin-bottom:15px;background:#f9f9f9;cursor:pointer;transition:all 0.3s}
.file-slot:hover{border-color:#667eea;background:#f8f9ff}
.file-slot.filled{border-color:#667eea;background:#e8f4f8}
.compare-result{margin-top:20px;padding:20px;border-radius:10px;text-align:center;font-size:1.1em;font-weight:600;display:none}
.compare-result.show{display:block}
.compare-result.match{background:#d4edda;color:#155724;border:2px solid #c3e6cb}
.compare-result.different{background:#f8d7da;color:#721c24;border:2px solid #f5c6cb}
.error-message{background:#f8d7da;color:#721c24;padding:15px;border-radius:10px;border-left:4px solid #e74c3c;margin-top:15px;display:none}
.error-message.show{display:block}
</style>
</head>
<body>
<div class="container">
<div class="login-screen" id="loginScreen">
<h1>üîê VeriSource Beta Access</h1>
<p>This beta test is invite-only. Enter your access key.</p>
<div class="login-form">
<input type="password" id="accessKey" placeholder="Enter beta access key">
<button onclick="checkAccess()">Access Beta</button>
<p class="error" id="errorMsg">‚ùå Invalid access key</p>
</div>
<div class="beta-info"><strong>üß™ Beta Testers:</strong><br>Check your invitation email for the access key.</div>
</div>

<div class="test-interface" id="testInterface">
<h1>üîç VeriSource Beta</h1>
<p class="subtitle">Media Verification API</p>

<div class="format-badges">
<div class="format-badge">üì∑ JPG, PNG, GIF</div>
<div class="format-badge">üé¨ MP4, MOV, AVI</div>
<div class="format-badge">üéµ MP3, WAV, M4A</div>
<div class="format-badge">üì¶ Up to 100MB</div>
</div>

<div class="tabs">
<button class="tab active" onclick="switchTab('single')">Single Upload</button>
<button class="tab" onclick="switchTab('compare')">Compare Files</button>
</div>

<div id="singleTab" class="tab-content active">
<div class="upload-area" id="uploadArea">
<div style="font-size:3em;margin-bottom:10px">üìÅ</div>
<p><strong>Click or drag file here</strong></p>
<p style="margin-top:10px;color:#666;font-size:0.9em">Test any media file</p>
<input type="file" id="fileInput" accept="image/*,video/*,audio/*">
</div>
<div class="selected-file" id="selectedFile"></div>
<div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>
<button id="uploadBtn" disabled>Upload & Verify</button>
<div class="error-message" id="errorMessage"></div>
<div class="loading" id="loading"><div class="spinner"></div><p style="margin-top:15px;color:#666">Analyzing...</p></div>
<div class="result" id="result">
<button class="copy-btn" onclick="copyFingerprint()">üìã Copy Hash</button>
<h3 style="color:#667eea;margin-bottom:15px">‚úÖ Result</h3>
<pre id="resultJson"></pre>
</div>
</div>

<div id="compareTab" class="tab-content">
<p style="color:#666;margin-bottom:20px;text-align:center">Upload two files to verify if they produce the same fingerprint</p>
<div class="file-slot" id="slot1" onclick="document.getElementById('file1Input').click()">
<div style="font-size:2em;margin-bottom:10px">üìÅ</div>
<strong>File 1</strong>
<p style="color:#666;margin-top:5px;font-size:0.9em">Click to select</p>
<input type="file" id="file1Input" style="display:none" accept="image/*,video/*,audio/*">
</div>
<div class="file-slot" id="slot2" onclick="document.getElementById('file2Input').click()">
<div style="font-size:2em;margin-bottom:10px">üìÅ</div>
<strong>File 2</strong>
<p style="color:#666;margin-top:5px;font-size:0.9em">Click to select</p>
<input type="file" id="file2Input" style="display:none" accept="image/*,video/*,audio/*">
</div>
<button id="compareBtn" disabled onclick="compareFiles()">Compare Fingerprints</button>
<div class="error-message" id="compareError"></div>
<div class="loading" id="compareLoading"><div class="spinner"></div><p style="margin-top:15px;color:#666">Comparing...</p></div>
<div class="compare-result" id="compareResult"></div>
</div>

<div class="info">
<strong>üß™ Testing Guide:</strong>
<ul style="margin-left:20px;margin-top:10px">
<li>Upload any media file up to 100MB</li>
<li>Copy the fingerprint for your records</li>
<li>Use Compare tab to verify same file = same hash</li>
<li>Report any issues or bugs</li>
</ul>
</div>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>
</div>

<script>
const BETA_ACCESS_KEY="verisource-beta-2024";
const API_URL="https://api.verisource.io/verify";
let isAuthenticated=false;
let file1=null,file2=null;

const errorMessages={
  'File too large':'File exceeds 100MB limit. Please use a smaller file.',
  'No file':'Please select a file first.',
  'Network request failed':'Connection failed. Check your internet and try again.',
  'Failed to fetch':'Could not connect to server. Please try again.',
  'Unsupported file type':'File type not supported. Use JPG, PNG, MP4, MP3, etc.'
};

window.onload=function(){
  if(sessionStorage.getItem('betaAccess')===BETA_ACCESS_KEY){
    showTestInterface()
  }
};

function checkAccess(){
  const inputKey=document.getElementById('accessKey').value;
  if(inputKey===BETA_ACCESS_KEY){
    sessionStorage.setItem('betaAccess',inputKey);
    document.getElementById('errorMsg').classList.remove('show');
    showTestInterface()
  }else{
    document.getElementById('errorMsg').classList.add('show');
    document.getElementById('accessKey').value=''
  }
}

function showTestInterface(){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('testInterface').classList.add('show');
  isAuthenticated=true
}

function logout(){
  sessionStorage.removeItem('betaAccess');
  document.getElementById('testInterface').classList.remove('show');
  document.getElementById('loginScreen').style.display='block';
  document.getElementById('accessKey').value='';
  isAuthenticated=false
}

function switchTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  if(tab==='single'){
    document.querySelector('.tab:nth-child(1)').classList.add('active');
    document.getElementById('singleTab').classList.add('active')
  }else{
    document.querySelector('.tab:nth-child(2)').classList.add('active');
    document.getElementById('compareTab').classList.add('active')
  }
}

function showError(elementId,message){
  const el=document.getElementById(elementId);
  const friendly=errorMessages[message]||message;
  el.textContent='‚ö†Ô∏è '+friendly;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),5000)
}

document.getElementById('accessKey')?.addEventListener('keypress',function(e){
  if(e.key==='Enter')checkAccess()
});

const fileInput=document.getElementById('fileInput');
const uploadArea=document.getElementById('uploadArea');
const uploadBtn=document.getElementById('uploadBtn');
const loading=document.getElementById('loading');
const result=document.getElementById('result');
const resultJson=document.getElementById('resultJson');
const selectedFile=document.getElementById('selectedFile');
const progressBar=document.getElementById('progressBar');
const progressFill=document.getElementById('progressFill');
let currentFile=null;

if(uploadArea){
  uploadArea.addEventListener('click',()=>fileInput.click());
  fileInput.addEventListener('change',(e)=>{
    if(e.target.files.length>0){
      currentFile=e.target.files[0];
      uploadBtn.disabled=false;
      selectedFile.textContent=`üìé ${currentFile.name} (${(currentFile.size/1024/1024).toFixed(2)} MB)`;
      selectedFile.classList.add('show')
    }
  });
  
  ['dragover','dragleave','drop'].forEach(evt=>{
    uploadArea.addEventListener(evt,(e)=>e.preventDefault())
  });
  
  uploadArea.addEventListener('dragover',()=>uploadArea.classList.add('dragover'));
  uploadArea.addEventListener('dragleave',()=>uploadArea.classList.remove('dragover'));
  uploadArea.addEventListener('drop',(e)=>{
    uploadArea.classList.remove('dragover');
    if(e.dataTransfer.files.length>0){
      currentFile=e.dataTransfer.files[0];
      uploadBtn.disabled=false;
      selectedFile.textContent=`üìé ${currentFile.name} (${(currentFile.size/1024/1024).toFixed(2)} MB)`;
      selectedFile.classList.add('show')
    }
  })
}

if(uploadBtn){
  uploadBtn.addEventListener('click',async()=>{
    if(!currentFile||!isAuthenticated)return;
    uploadBtn.disabled=true;
    loading.classList.add('show');
    result.classList.remove('show');
    progressBar.classList.add('show');
    progressFill.style.width='0%';
    
    const formData=new FormData();
    formData.append('file',currentFile);
    
    try{
      progressFill.style.width='30%';
      const response=await fetch(API_URL,{method:'POST',body:formData});
      progressFill.style.width='80%';
      const data=await response.json();
      progressFill.style.width='100%';
      
      if(!response.ok){
        throw new Error(data.error||data.message||'Upload failed')
      }
      
      resultJson.textContent=JSON.stringify(data,null,2);
      result.classList.add('show')
    }catch(error){
      showError('errorMessage',error.message);
      console.error('Upload error:',error)
    }finally{
      loading.classList.remove('show');
      progressBar.classList.remove('show');
      uploadBtn.disabled=false
    }
  })
}

function copyFingerprint(){
  try{
    const data=JSON.parse(resultJson.textContent);
    const fp=data.canonical?.fingerprint||'No fingerprint found';
    navigator.clipboard.writeText(fp);
    alert('‚úÖ Fingerprint copied to clipboard!')
  }catch(e){
    alert('‚ùå Could not copy fingerprint')
  }
}

document.getElementById('file1Input')?.addEventListener('change',function(e){
  if(e.target.files.length>0){
    file1=e.target.files[0];
    document.getElementById('slot1').classList.add('filled');
    document.getElementById('slot1').innerHTML=`<div style="font-size:2em;margin-bottom:10px">‚úÖ</div><strong>File 1</strong><p style="font-size:0.85em;color:#666;margin-top:5px">${file1.name}</p>`;
    checkCompareReady()
  }
});

document.getElementById('file2Input')?.addEventListener('change',function(e){
  if(e.target.files.length>0){
    file2=e.target.files[0];
    document.getElementById('slot2').classList.add('filled');
    document.getElementById('slot2').innerHTML=`<div style="font-size:2em;margin-bottom:10px">‚úÖ</div><strong>File 2</strong><p style="font-size:0.85em;color:#666;margin-top:5px">${file2.name}</p>`;
    checkCompareReady()
  }
});

function checkCompareReady(){
  document.getElementById('compareBtn').disabled=!(file1&&file2)
}

async function uploadForCompare(file){
  const formData=new FormData();
  formData.append('file',file);
  const response=await fetch(API_URL,{method:'POST',body:formData});
  if(!response.ok)throw new Error('Upload failed');
  return await response.json()
}

async function compareFiles(){
  if(!file1||!file2)return;
  document.getElementById('compareBtn').disabled=true;
  document.getElementById('compareLoading').classList.add('show');
  document.getElementById('compareResult').classList.remove('show');
  
  try{
    const [result1,result2]=await Promise.all([
      uploadForCompare(file1),
      uploadForCompare(file2)
    ]);
    
    const fp1=result1.canonical?.fingerprint;
    const fp2=result2.canonical?.fingerprint;
    const compareResult=document.getElementById('compareResult');
    
    if(fp1===fp2){
      compareResult.className='compare-result match show';
      compareResult.innerHTML=`<div style="font-size:2em;margin-bottom:10px">‚úÖ</div><strong>MATCH!</strong><p style="margin-top:10px;font-size:0.9em;font-weight:normal">Both files produce the same fingerprint</p><code style="display:block;margin-top:10px;font-size:0.75em;background:white;padding:10px;border-radius:5px;word-break:break-all">${fp1}</code>`
    }else{
      compareResult.className='compare-result different show';
      compareResult.innerHTML=`<div style="font-size:2em;margin-bottom:10px">‚ùå</div><strong>DIFFERENT</strong><p style="margin-top:10px;font-size:0.9em;font-weight:normal">Files have different fingerprints</p>`
    }
  }catch(error){
    showError('compareError',error.message)
  }finally{
    document.getElementById('compareLoading').classList.remove('show');
    document.getElementById('compareBtn').disabled=false
  }
}
</script>
</body>
</html>